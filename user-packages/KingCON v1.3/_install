; KingCON v1.3
; ------------
;
; Date: 2021-11-28
; Author: Henrik Noerfjand Stengaard
;
; User package for HstWB Installer to automate installation of KingCON.


; paths
set sdir "`execute INSTALLDIR:S/CombinePath "$INSTALLDIR" "S"`"
set usfile "`execute INSTALLDIR:S/CombinePath "$INSTALLDIR" "S/User-Startup"`"
set ldir "`execute INSTALLDIR:S/CombinePath "$INSTALLDIR" "L"`"
set devsdir "`execute INSTALLDIR:S/CombinePath "$INSTALLDIR" "Devs"`"

; create user startup file, if it doesn't exist 
IF NOT EXISTS "$usfile"
  Echo "" NOLINE >"$usfile"
ENDIF

; write install status
echo "KingCON..."

; extract kingcon to temp systemdir
lha -m1 -q x "USERPACKAGEDIR:KingCON_1.3.lha" "SYSTEMDIR:Temp/_KingCON/"

; install kingcon files
Copy >NIL: "SYSTEMDIR:Temp/_KingCON/KingCON1.3/Handler/KingCON-handler#?" "$ldir" CLONE
Copy >NIL: "SYSTEMDIR:Temp/_KingCON/KingCON1.3/Handler/KingCON-mountlist" "$devsdir" CLONE

; delete igame from temp systemdir
Delete >NIL: "SYSTEMDIR:Temp/_KingCON" ALL

; install kingcon startup
Copy >NIL: "USERPACKAGEDIR:KingCON-Startup" "$sdir"

; add kingcon to user startup, if not present
Search >NIL: "$usfile" "Execute S:KingCON-Startup" quiet
IF NOT $RC EQ 0 VAL
  Type USERPACKAGEDIR:Add-KingCON-Startup >>"$usfile"
ENDIF


; end
; ---
LAB end
